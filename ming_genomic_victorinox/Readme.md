<!-- dx-header -->
# Ming Genomic Victorinox (DNAnexus Platform App)


This is the source code for an app that runs on the DNAnexus Platform.
For more information about how to run or modify it, see
https://wiki.dnanexus.com/.
<!-- /dx-header -->

<!-- Insert a description of your app here -->
# This is Ming's version of swiss army knife
# Preloaded with most bioinformatic tools for genomic study, gatk4, samtools, bedtools, cnvkit, survivor etc
# Need a sh to run mutli-line command of interest.

# template for cmd_sh (funcotator annotation)

############################

 Inputfileloc="/gatk/data/in/"
 outfolder="/gatk/data/out/"
 echo $cmdstr

 if [ "$cmdstr" = "hg19" ]; then
  genome_build="hg19"
  echo $genome_build
 else
  genome_build="hg38"
  echo $genome_build
 fi

 cd $Inputfileloc

 ls *_twicefiltered.vcf.gz > ${Inputfileloc}vcf.list

 sed -i 's/\_twicefiltered.vcf.gz//' ${Inputfileloc}vcf.list

 cat ${Inputfileloc}vcf.list

 funconator_data=$(ls *.tar.gz)
 echo $funconator_data

 Reference=$(ls *.fa)
 echo $Reference
 #optional step of annotation

 echo "##annotate with Funconator"

  tar -xzf $Inputfileloc$funconator_data --no-same-owner#  Dir_name=`tar -tzf $Inputfileloc$funconator_data | head -1 | cut -f1 -d"/"`
  echo $Dir_name
  
 while read sm_name;
  do 
  echo $sm_name 
  outbam=${outfolder}${sm_name}

  zcat ${sm_name}_twicefiltered.vcf.gz |grep -E '^#|PASS' > ${sm_name}_twicefiltered.vcf
  bcftools index -t ${sm_name}_twicefiltered.vcf

  gatk Funcotator \
   -R $Inputfileloc$Reference \
   -V ${Inputfileloc}${sm_name}_twicefiltered.vcf \
   -O ${outbam}_annotated.vcf \
   --output-file-format VCF \
   --data-sources-path $Inputfileloc$Dir_name \
   --ref-version $genome_build
 
  bgzip -c ${outbam}_annotated.vcf > ${outbam}_annotated.vcf.gz
  tabix -p vcf ${outbam}_annotated.vcf.gz
  
 done < ${Inputfileloc}vcf.list


############################
<!--
TODO: This app directory was automatically generated by dx-app-wizard;
please edit this Readme.md file to include essential documentation about
your app that would be helpful to users. (Also see the
Readme.developer.md.) Once you're done, you can remove these TODO
comments.

For more info, see https://wiki.dnanexus.com/Developer-Portal.
-->
